"use strict";(self.webpackChunkevil_instagram=self.webpackChunkevil_instagram||[]).push([[861],{6377:()=>{},861:(e,n,t)=>{t.r(n),t.d(n,{default:()=>x});var r=t(2483),c=t(3376),s=t(7757),i=t(5197),l=t(6854),d=t(6723);const o=e=>{var n;let{conver:t,latestchat:c,setFromconv:o,fromconv:a}=e,u=(0,s.d4)((e=>e.youryr.value)),h=(0,s.d4)((e=>e.themeyr.value)),[m,f]=(0,r.useState)(""),[g,p]=(0,r.useState)(!1),[v,j]=(0,r.useState)([]),x=(0,s.wA)(),b="http://localhost:3001";(0,r.useEffect)((()=>{var e;let n=null===(e=t.members)||void 0===e?void 0:e.find((e=>e!==u.userid));fetch("".concat(b,"/messenger/getconvostuff/").concat(n),{credentials:"include"}).then((e=>e.json())).then((e=>{f(e),p((e=>!0)),o((n=>({...n,[t._id]:e})))})).catch((e=>{console.log(e)}))}),[u,t,o]);return(0,d.jsxs)("div",{className:v.includes(m.username)?c[t._id]?"convonewer":h?"convo":"convonight":null!==m&&void 0!==m&&null!==(n=m.blocked)&&void 0!==n&&n.includes(u.usrn)?"convotheyblocked":u.blocked.includes(m.username)?"convoyoublocked":c[t._id]?"convonewer":h?"convo":"convonight",children:[g?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("img",{className:"convoimg",alt:" ",src:m.pfp}),(0,d.jsx)("span",{className:h?"convoname":"convoname convonamenightmode",children:m.fname})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"chatpfpskeleton",children:(0,d.jsx)(l.A,{})}),(0,d.jsx)("div",{className:"chatfnameskeleton",children:(0,d.jsx)(l.A,{})})]}),!v.includes(m.username)&&u.blocked.includes(m.username)&&(0,d.jsx)("button",{className:"unblocker",onClick:()=>{!async function(){j([...v,m.username]),await fetch("".concat(b,"/users/unblock/").concat(u.usrn),{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:m.username})}),a[t._id].unblockattempt=!0,o((e=>({...e})));const e=u.blocked.filter((e=>e!=m.username)),n={pfp:u.pfp,usrn:u.usrn,email:u.email,fullname:u.fullname,userid:u.userid,following:u.following,blocked:e};x((0,i.XG)(n))}()},children:"UNBLOCK"})]})};var a=t(5290);const u=e=>{let{onechat:n,own:t,ident:c,status:i,id:o,rec:u,pfpobj:h,finalseen:m,messages:f,setMessages:g,Currentchat:p,socket:v,setShddel:j,setTextdets:x,redisplaylane:b,setRedisplaylane:y,redselector:w,setRedselector:_,setNodel:S,goback:N,setGoback:T,groupdeletion:C,groupie:O,safeinherit:k,setMultiplelast:E,sempahore:P}=e,[J,M]=(0,r.useState)({}),[R,A]=(0,r.useState)(null),[H,L]=(0,r.useState)({}),Z=(0,s.d4)((e=>e.youryr.value)),I=(0,s.d4)((e=>e.themeyr.value)),B=e=>{setTimeout((()=>{M((n=>({...n,[e]:!0}))),L((n=>({...n,[e]:!0})))}),1)},z="http://localhost:3001",D=e=>{_((n=>Object.keys(n).includes(e)?(n[e]=!n[e],{...n}):{...n,[e]:!0}))},F=e=>{if(1==e.length){let n=!1;e[0]._id===f[f.length-1]._id&&(n=!0),fetch("".concat(z,"/messenger/delete/").concat(e[0]._id),{method:"DELETE",credentials:"include"}).then((e=>e.json())).then((t=>{fetch("".concat(z,"/messenger/ex/").concat(p._id),{credentials:"include"}).then((e=>e.json())).then((t=>{let r=t.filter((e=>e.holders.includes(Z.userid)));g(r),j(!0),x({msg:e[0],last:n})})).catch((e=>{console.log(e)}));const r=p.members.find((e=>e!==Z.userid));v.current.emit("clienttextdel",{receiverid:r,convid:p._id})})).catch((e=>{console.log(e)}))}else{k.current={...k.current,[e._id]:[!0,f.indexOf(e)]};let n=!1;e._id===f[f.length-1]._id&&(n=!0),fetch("".concat(z,"/messenger/delete/").concat(e._id),{method:"DELETE",credentials:"include"}).then((e=>e.json())).then((t=>{fetch("".concat(z,"/messenger/ex/").concat(p._id),{credentials:"include"}).then((e=>e.json())).then((t=>{let r=t.filter((e=>e.holders.includes(Z.userid)));g(r),j(!0),x({msg:e,last:n})})).catch((e=>{console.log(e)}));const r=p.members.find((e=>e!==Z.userid));v.current.emit("clienttextdel",{receiverid:r,convid:p._id})})).catch((e=>{console.log(e)}))}},V=e=>{navigator.clipboard.writeText(e),A(!0)};(0,r.useEffect)((()=>{const e=setTimeout((()=>{A(null)}),3e3);return()=>{clearTimeout(e)}}),[R]);let G=()=>{},X=e=>{L({}),y(!0),_((n=>({...n,[e._id]:!0}))),S(!0)};return(0,r.useEffect)((()=>{N&&(T(!1),S(!1),y(null),_({}))}),[N]),(0,r.useEffect)((()=>{if(C&&O){let e=Object.keys(w);for(let n=0;n<e.length;n++)k.current={...k.current,[e[n]]:[!0,f.indexOf(f.find((t=>t._id===e[n])))]};w[f[f.length-1]._id]&&E(!0),F([n])}}),[C]),(0,r.useEffect)((()=>{let e=e=>{e.target.matches(".textoptions")||M({})};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}})),(0,d.jsx)(d.Fragment,{children:n._id?(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("div",{className:t?w[o]?"reddisplay textabyss own":R?"greendisplay textabyss own":"textabyss own":"textabyss",children:[(0,d.jsxs)("div",{className:"textabyssupper",children:[P?!t&&h[o]&&(0,d.jsx)("img",{className:"abysspfp",alt:"",src:null!=c?c.pfp:" "}):!t&&h[o]&&(0,d.jsxs)("div",{className:"abysspfpskeleton",children:[" ",(0,d.jsx)(l.A,{})]}),(0,d.jsx)("p",{className:n.thetext.length<300?"themessager":"thelongmessager",onClick:t?b?()=>{D(o)}:()=>{B(o)}:console.log(" "),children:n.thetext}),H[o]&&t&&J[o]&&(0,d.jsxs)("div",{className:"textoptions right",children:[(0,d.jsx)("div",{children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",fillRule:"currentColor",className:"bi bi-trash3 delete",onClick:()=>{F(n)},viewBox:"0 0 16 16",children:(0,d.jsx)("path",{d:"M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"})})}),(0,d.jsx)("div",{children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",fillRule:"currentColor",className:"bi bi-files copy",onClick:()=>{V(n.thetext)},viewBox:"0 0 16 16",children:(0,d.jsx)("path",{d:"M13 0H6a2 2 0 0 0-2 2 2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2 2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm0 13V4a2 2 0 0 0-2-2H5a1 1 0 0 1 1-1h7a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1zM3 4a1 1 0 0 1 1-1h7a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V4z"})})}),(0,d.jsx)("div",{children:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",fillRule:"currentColor",className:"bi bi-check-square select",onClick:()=>{X(n)},viewBox:"0 0 16 16",children:[(0,d.jsx)("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}),(0,d.jsx)("path",{d:"M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.235.235 0 0 1 .02-.022z"})]})}),(0,d.jsx)("div",{children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",fillRule:"currentColor",className:"bi bi-x cancel",onClick:G,viewBox:"0 0 16 16",children:(0,d.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})})})]}),R&&(0,d.jsx)("p",{className:"status",children:"TEXT COPIED "}),w[o]&&b&&(0,d.jsx)("p",{className:"statusred",children:"TEXT SELECTED "}),(0,d.jsx)("p",{className:w[o]?"redstamp":I?"timestamp":"timestamp timenight",children:/^((?!seconds).)*$/.test((0,a.GP)(null===n||void 0===n?void 0:n.createdAt))?(0,a.GP)(null===n||void 0===n?void 0:n.createdAt):"just now"})]}),(0===Object.keys(m).length?i&&o===u&&t:m[o]&&i&&o===u&&t)&&(0,d.jsx)("div",{className:"textabysslower",children:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"20",fill:"currentColor",className:"bi bi-eye",viewBox:"0 0 16 16",children:[(0,d.jsx)("path",{d:"M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"}),(0,d.jsx)("path",{d:"M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"})]})})]})}):(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("div",{className:t?w[o]?"reddisplay textabyss own invisibility":R?"greendisplay textabyss own invisibility":"textabyss own invisibility":"textabyss invisibility",children:[(0,d.jsxs)("div",{className:"textabyssupper invisibility",children:[!t&&h[o]&&(0,d.jsx)("img",{className:"abysspfp",alt:"",src:null!=c?c.pfp:" "}),(0,d.jsx)("p",{className:n.thetext.length<300?"themessage":"thelongmessage",onClick:t?b?()=>{D(o)}:()=>{B(o)}:console.log(" "),children:n.thetext}),H[o]&&t&&J[o]&&(0,d.jsxs)("div",{className:"textoptions right",children:[(0,d.jsx)("div",{children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",fillRule:"currentColor",className:"bi bi-trash3 delete",onClick:()=>{F(n)},viewBox:"0 0 16 16",children:(0,d.jsx)("path",{d:"M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"})})}),(0,d.jsx)("div",{children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",fillRule:"currentColor",className:"bi bi-files copy",onClick:()=>{V(n.thetext)},viewBox:"0 0 16 16",children:(0,d.jsx)("path",{d:"M13 0H6a2 2 0 0 0-2 2 2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2 2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm0 13V4a2 2 0 0 0-2-2H5a1 1 0 0 1 1-1h7a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1zM3 4a1 1 0 0 1 1-1h7a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V4z"})})}),(0,d.jsx)("div",{children:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",fillRule:"currentColor",className:"bi bi-check-square select",onClick:()=>{X(n)},viewBox:"0 0 16 16",children:[(0,d.jsx)("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}),(0,d.jsx)("path",{d:"M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.235.235 0 0 1 .02-.022z"})]})}),(0,d.jsx)("div",{children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",fillRule:"currentColor",className:"bi bi-x cancel",onClick:G,viewBox:"0 0 16 16",children:(0,d.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})})})]}),R&&(0,d.jsx)("p",{className:"status",children:"TEXT COPIED "}),w[o]&&b&&(0,d.jsx)("p",{className:"statusred",children:"TEXT SELECTED "}),(0,d.jsx)("p",{className:w[o]?"redstamp":"timestamp",children:/^((?!seconds).)*$/.test((0,a.GP)(null===n||void 0===n?void 0:n.createdAt))?(0,a.GP)(null===n||void 0===n?void 0:n.createdAt):"just now"})]}),(0===Object.keys(m).length?i&&o===u&&t:m[o]&&i&&o===u&&t)&&(0,d.jsx)("div",{className:"textabysslower invisibility",children:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"20",fill:"currentColor",className:"bi bi-eye",viewBox:"0 0 16 16",children:[(0,d.jsx)("path",{d:"M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"}),(0,d.jsx)("path",{d:"M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"})]})})]})})})};var h=t(4202);const m=e=>{let{onl:n,setCurrentchat:t,Currentchat:c,setDraft:i,draft:l,outsider:o,setOutsider:a,semaphore:u,setOnlchatclicked:m,onlchatclicked:f}=e,[g,p]=(0,r.useState)([]),[v,j]=(0,r.useState)([]),[x,b]=(0,r.useState)(!1),[y,w]=(0,r.useState)({}),[_,S]=(0,r.useState)(!0),N=(0,s.d4)((e=>e.youryr.value)),T=(0,s.d4)((e=>e.themeyr.value)),C=(0,r.useRef)(!1),O="http://localhost:3001";if((0,r.useEffect)((()=>{fetch("".concat(O,"/messenger/getfren/").concat(N.userid),{credentials:"include"}).then((e=>e.json())).then((e=>{p(e),b((e=>!0))})).catch((e=>{console.log(e)}))}),[N,n]),(0,r.useEffect)((()=>{j(g.filter((e=>n.includes(e._id))))}),[g,n]),o.verdict){a(!1);let e=[N.userid,o.data];fetch("".concat(O,"/messenger/alreadyconv/checker"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"}).then((e=>e.json())).then((e=>{if(null!=e)t(e);else{let e={senderId:N.userid,receiverId:o.data};fetch("".concat(O,"/messenger/create"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"}).then((e=>e.json())).then((e=>{t(e),i(e),fetch("".concat(O,"/messenger/delconv/").concat(e._id),{method:"DELETE",credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}})).catch((e=>{console.log(e)}))}let k=e=>{w((n=>({...n,[e._id]:!1})));let n={senderId:N.userid,receiverId:e._id};fetch("".concat(O,"/messenger/create"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),credentials:"include"}).then((e=>e.json())).then((e=>{t(e),i(e),fetch("".concat(O,"/messenger/delconv/").concat(e._id),{method:"DELETE",credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))};return(0,d.jsx)("div",{className:"online",children:v.map((e=>(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"allonline",onClick:()=>(e=>{let n=null;if(n=(null===l||void 0===l?void 0:l.members[0])!=N.userid?null===l||void 0===l?void 0:l.members[0]:null===l||void 0===l?void 0:l.members[1],e._id!=n||c!=l){let n=[N.userid,e._id];fetch("".concat(O,"/messenger/alreadyconv/checker"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),credentials:"include"}).then((e=>e.json())).then((n=>{null!=n?(t(n),m(!f)):(w((n=>({...n,[e._id]:!0}))),C.current=!0)})).catch((e=>{console.log(e)}))}})(e),children:[(0,d.jsxs)("div",{className:"onlinepfpcont",children:[x&&(0,d.jsx)("img",{className:"onlinepfp",alt:" ",src:e.profpic}),(0,d.jsx)("div",{className:"onlinemark"})]}),(0,d.jsx)("span",{className:T?"onlineusername":"onlineusername onlnight",children:e.fullname})]}),y[e._id]&&(0,d.jsx)(h.A,{trigger:w,text:"Do you want to start conversation with ",bold:e.fullname,extra:{purpose:"newconv",main:e,startconvhandler:k,setOnlchatclicked:m,skeletonidentity:f}})]},e._id)))})};var f=t(8335),g=t(61),p=t(87),v=t(5035),j=t(3057);const x=()=>{let e=(0,s.d4)((e=>e.youryr.value)),n=(0,s.d4)((e=>e.themeyr.value)),[t,i]=(0,r.useState)(!1),[a,h]=(0,r.useState)([]),[x,b]=(0,r.useState)(!1),[y,w]=(0,r.useState)([]),[_,S]=(0,r.useState)(null),[N,T]=(0,r.useState)(""),[C,O]=(0,r.useState)(!1),[k,E]=(0,r.useState)([]),[P,J]=(0,r.useState)(null),[M,R]=(0,r.useState)([]),[A,H]=(0,r.useState)(null),[L,Z]=(0,r.useState)([]),[I,B]=(0,r.useState)(!1),[z,D]=(0,r.useState)({}),[F,V]=(0,r.useState)({}),[G,X]=(0,r.useState)(null),[q,$]=(0,r.useState)(!1),[U,W]=(0,r.useState)(null),[K,Y]=(0,r.useState)(!1),[Q,ee]=(0,r.useState)(!1),[ne,te]=(0,r.useState)(!1),[re,ce]=(0,r.useState)(!1),[se,ie]=(0,r.useState)(null),[le,de]=(0,r.useState)({}),[oe,ae]=(0,r.useState)(!1),[ue,he]=(0,r.useState)({}),[me,fe]=(0,r.useState)(null),[ge,pe]=(0,r.useState)(null),[ve,je]=(0,r.useState)(null),[xe,be]=(0,r.useState)(!1),[ye,we]=(0,r.useState)(!1),[_e,Se]=(0,r.useState)(!1),[Ne,Te]=(0,r.useState)(!1),[Ce,Oe]=(0,r.useState)(!1),[ke,Ee]=(0,r.useState)({}),[Pe,Je]=(0,r.useState)({verdict:!1,data:null}),[Me,Re]=(0,r.useState)(!1),Ae=(0,r.useRef)(null),He=(0,r.useRef)(null),Le=(0,r.useRef)(null),Ze=(0,r.useRef)(""),Ie=(0,r.useRef)(null),Be=(0,r.useRef)(null),ze=(0,r.useRef)(null),De=(0,r.useRef)(null),Fe=(0,r.useRef)(null),Ve=(0,r.useRef)(z),Ge=(0,r.useRef)(_),Xe=(0,r.useRef)(y),qe=(0,r.useRef)(L),$e=(0,r.useRef)(!1),Ue=(0,r.useRef)(null),We=(0,r.useRef)(null),Ke=(0,r.useRef)(null),Ye=(0,r.useRef)(!1),Qe=(0,r.useRef)(!1),en=(0,r.useRef)(ue),nn=(0,r.useRef)(a),tn=(0,r.useRef)(le),rn=(0,r.useRef)({}),cn=(0,r.useRef)(9999999999),sn=(0,r.useRef)(0),ln=(0,r.useRef)(0),dn=(0,r.useRef)(null),on=(0,r.useRef)(1),an=(0,r.useRef)([]),un=(0,r.useRef)(!1),hn=(0,s.wA)(),mn="http://localhost:3001";(0,r.useEffect)((()=>{if(Ze.current=(0,f.io)("ws://localhost:3002"),Ze.current.on("textserver",(n=>{var t;if((null===(t=Ge.current)||void 0===t?void 0:t._id)===n.converid&&fetch("".concat(mn,"/messenger/seen/")+n.saveID,{credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)})),Z((e=>e.filter((e=>e!==n.converid)))),he((e=>{if(null==Ge.current||n.converid!=Ge.current._id){let e=en.current;return e[n.converid]=!0,{...e}}{let e=en.current;return e[n.converid]=!1,{...e}}})),h((t=>{b(!0);let r=nn.current,c=r.filter((e=>e._id===n.converid));if(0==c.length){let t={_id:n.converid,members:[e.userid,n.sender],holders:[e.userid,n.sender]};return r.unshift(t),[...r]}{let e=r.filter((e=>e._id!==n.converid));return e.unshift(c[0]),[...e]}})),0==Xe.current.length||Xe.current[0].conversationId!==n.converid?Oe(!0):J({conversationId:n.converid,sender:n.sender,receiver:n.receiver,thetext:n.recenttext,createdAt:Date.now(),status:n.status,order:n.order,holders:n.holders}),null!=Ge.current&&Ge.current._id===n.curchat._id)for(let i=Xe.current.length-1;i>=0;i--){var r,c,s;if(1==(null===(r=Xe.current[i])||void 0===r?void 0:r.status)){const n=Ge.current.members.find((n=>n!==e.userid));fetch("".concat(mn,"/messenger/ex/")+Ge.current._id,{credentials:"include"}).then((e=>e.json())).then((e=>{Xe.current=e,Ze.current.emit("clientseen",{receiverid:n,status:!0,messagesREC:e,curchat:Ge.current})})).catch((e=>{console.log(e)}));break}(null===(c=Xe.current[i])||void 0===c?void 0:c.sender)!==e.userid&&fetch("".concat(mn,"/messenger/seen/")+(null===(s=Xe.current[i])||void 0===s?void 0:s._id),{credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}));const n=Ge.current.members.find((n=>n!==e.userid));fetch("".concat(mn,"/messenger/ex/")+Ge.current._id,{credentials:"include"}).then((e=>e.json())).then((e=>{Xe.current=e,Ze.current.emit("clientseen",{receiverid:n,status:!0,messagesREC:e,curchat:Ge.current})})).catch((e=>{console.log(e)}))}n.sender===e.userid?Ie.current=!0:Ie.current=!1})),Ze.current.on("servertypes",(e=>{e.status?qe.current.includes(e.curchat._id)||Z((n=>[...n,e.curchat._id])):e.status||qe.current.includes(e.curchat._id)&&Z((n=>n.filter((n=>n!==e.curchat._id))))})),Ze.current.on("serverseen",(n=>{let t=n.messagesREC.filter((n=>n.holders.includes(e.userid))),r=n.messagesREC.filter((n=>n.holders.includes(e.userid)));r[r.length-1].status=!0;for(let c=r.length-1;c>=0&&1!=Ve.current[r[c]._id];c--)r[c].sender===e.userid&&D((e=>({...e,[r[c]._id]:!0})));w(t)})),Ze.current.on("servertextdel",(n=>{fetch("".concat(mn,"/messenger/ex/").concat(n.convid),{credentials:"include"}).then((e=>e.json())).then((n=>{let t=n.filter((n=>n.holders.includes(e.userid)));w(t)})).catch((e=>{console.log(e)}))})),Ze.current.on("serverdelchange",(n=>{fetch("".concat(mn,"/messenger/lineup/order/").concat(e.userid),{credentials:"include"}).then((e=>e.json())).then((e=>{h(e.convs.lineup),b(!0),void 0!=e.convs.unread&&he(e.convs.unread)})).catch((e=>{console.log(e)}))})),Ze.current.on("serveraddholder",(n=>{fetch("".concat(mn,"/messenger/lineupholder/").concat(e.userid),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({members:n.members,curchat:n.curchat}),credentials:"include"}).then((e=>e.json())).then((e=>{setTimeout((()=>{h((t=>{b(!0);let r=e.lineup,c=r.filter((e=>e._id===n.curchat)),s=r.filter((e=>e._id!==n.curchat));if(0==c.length){let e={_id:n.curchat,members:n.members,holders:n.members};return s.unshift(e),[...s]}return s.unshift(c[0]),[...s]}))}),3e3)})).catch((e=>{console.log(e)}))})),Ze.current.on("serverchangetextnums",(n=>{let t=[];for(let r=n.nevermessages.length-1;r>=0&&!0!==n.nevermessages[r].status;r--)t.unshift(n.nevermessages[r]);if(t.length==n.nevermessages.length){async function c(){const e=await fetch("".concat(mn,"/messenger/delconv/").concat(n.convid),{method:"DELETE",credentials:"include"});await e.json()}h((()=>(b(!0),[...nn.current.filter((e=>e._id!=n.convid))]))),he((()=>{let e=en.current;return delete e[n.convid],{...e}})),fetch("".concat(mn,"/messenger/lineup/checker/").concat(e.userid),{credentials:"include"}).then((e=>e.json())).then((t=>{let r=t.lineup.filter((e=>e._id!=n.convid));delete t.unread[n.convid];let c={lineup:r,unread:t.unread};fetch("".concat(mn,"/messenger/lineup/").concat(e.userid),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c),credentials:"include"}).then((e=>e.json())).then((e=>{console.log(e)}))})),c(),0==!n.nevermessages.length&&n.nevermessages.map((n=>{n.receffected.map((t=>{fetch("".concat(mn,"/messenger/decrementer/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:[e.userid],brand:n.brand,user:"receiver"}),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))}))}))}else{if(he((()=>{let e=en.current;return e[n.convid]=!1,{...e}})),0!=t.length){h((()=>{b(!0);let e=nn.current.filter((e=>e._id!=n.convid)),t=nn.current.filter((e=>e._id===n.convid));return e.splice(e.length,0,t[0]),[...e]}));let s=[];for(let i=0;i<t.length;i++)for(let l=0;l<t[i].receffected.length;l++)s.unshift(t[i].receffected[l]);nn.current.filter((e=>!s.includes(e))).map((n=>{fetch("".concat(mn,"/messenger/decrementer/deltype").concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userid:e.userid}),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))})),0==!t.length&&t.map((n=>{n.receffected.map((t=>{fetch("".concat(mn,"/messenger/decrementer/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:[e.userid],brand:n.brand,user:"receiver"}),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))}))}))}setTimeout((()=>{fetch("".concat(mn,"/messenger/lineup/checker/").concat(e.userid),{credentials:"include"}).then((e=>e.json())).then((t=>{let r=t.lineup.filter((e=>e._id==n.convid))[0];let c=t.lineup.findIndex((e=>e==r));if(0==r.holders.length)r.holders.push(e.userid);else{let n=r.holders.filter((n=>n!=e.userid));r.holders=n}let s=t.lineup;s[c]=r;let i={lineup:s,unread:t.unread};fetch("".concat(mn,"/messenger/lineup/").concat(e.userid),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),credentials:"include"}).then((e=>e.json())).then((e=>{}))}))}),2e3)}})),Ze.current.on("newestdata",(()=>{if(oe)ae(!1);else if(null!=Ge.current){async function n(){const e=await fetch("".concat(mn,"/messenger/alreadyconv/checker"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ge.current.members),credentials:"include"}),n=await e.json();null!=n&&Ge.current._id===n._id&&(Ge.current=n)}fetch("".concat(mn,"/messenger/ex/").concat(Ge.current._id),{credentials:"include"}).then((e=>e.json())).then((n=>{let t=n.filter((n=>n.holders.includes(e.userid)));w(t)})).catch((e=>{console.log(e)})),n()}})),"o"==window.location.href.substring(32)[0][0]){let n=window.location.href.substring(41),t={senderId:e.userid,receiverId:n};fetch("".concat(mn,"/messenger/create"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"}).then((e=>e.json())).then((e=>{S(e),je(e),fetch("".concat(mn,"/messenger/delconv/").concat(e._id),{method:"DELETE",credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}}),[]),(0,r.useEffect)((()=>{Ve.current=z}),[z]),(0,r.useEffect)((()=>{qe.current=L}),[L]),(0,r.useEffect)((()=>{if(Ce&&(Oe(!1),null!=Ge.current)){const n=Ge.current.members.find((n=>n!==e.userid));fetch("".concat(mn,"/messenger/ex/").concat(Ge.current._id),{credentials:"include"}).then((e=>e.json())).then((t=>{let r=t.filter((n=>n.holders.includes(e.userid)));w(r),Ze.current.emit("clienttextdel",{receiverid:n,convid:Ge.current._id})})).catch((e=>{console.log(e)}))}}),[Ce]),(0,r.useEffect)((()=>{function n(n){if(!n.target.matches(".chatfield")){const n=null===_||void 0===_?void 0:_.members.find((n=>n!==e.userid));Ze.current.emit("clienttypes",{dims:null,status:!1,receiverid:n,curchat:_})}}return document.addEventListener("click",n),()=>{document.removeEventListener("click",n)}})),(0,r.useEffect)((()=>{var e;function n(e){var n,t,r;Math.abs((null===(n=Be.current)||void 0===n?void 0:n.scrollHeight)-(null===(t=Be.current)||void 0===t?void 0:t.clientHeight)-(null===(r=Be.current)||void 0===r?void 0:r.scrollTop))>80?ne||ce(!0):(ce(!1),te(!1))}return null===(e=Be.current)||void 0===e||e.addEventListener("scroll",n),()=>{var e;null===(e=Be.current)||void 0===e||e.removeEventListener("scroll",n)}})),(0,r.useEffect)((()=>{setTimeout((()=>{var e,n,t;Math.abs((null===(e=Be.current)||void 0===e?void 0:e.scrollHeight)-(null===(n=Be.current)||void 0===n?void 0:n.clientHeight)-(null===(t=Be.current)||void 0===t?void 0:t.scrollTop))<=49?setTimeout((()=>{var e;null===(e=ze.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),10):null!=P&&(te(!0),ce(!1)),P&&(null===_||void 0===_?void 0:_.members.includes(P.sender))&&w((e=>[...e,P])),setTimeout((()=>{Oe(!0)}),1e3),P&&(null===_||void 0===_?void 0:_.members.includes(P.sender))&&R((e=>[...e,Ie.current]))}),1e3)}),[P]);let fn=n=>{null!=Ge.current&&n._id!=Ge.current._id&&(un.current=!1),void 0!=ke[n._id]&&(e.blocked.includes(ke[n._id].username)||ke[n._id].blocked.includes(e.usrn)||(S(n),Ge.current=n,O(!0),Y(!0),ae(!0),he((e=>{let t=en.current;return t[n._id]=!1,{...t}}))))},gn=n=>{let t=Xe.current;!async function(){const r=await fetch("".concat(mn,"/messenger/findatleastone/").concat(e.userid),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({convid:n}),credentials:"include"}),c=await r.json(),s=Ge.current.members.find((n=>n!==e.userid));if(null===c.ans){S(null);let t={convid:n},r={convid:n,curuser:e.userid},c=[fetch("".concat(mn,"/messenger/conv/remover/").concat(e.userid),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"}),fetch("".concat(mn,"/messenger/conv/remover/").concat(s),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"include"}),fetch("".concat(mn,"/messenger/convholder/remover"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userid:e.userid,convid:n}),credentials:"include"})];Promise.all(c).then((n=>{fetch("".concat(mn,"/messenger/lineup/order/").concat(e.userid),{credentials:"include"}).then((e=>e.json())).then((e=>{h(e.convs.lineup),b(!0),void 0!=e.convs.unread&&he(e.convs.unread)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}else{2==Ge.current.holders.length&&(Qe.current=!0);const r=Ge.current.members.find((n=>n!==e.userid));let c=Xe.current,s={convid:n},i={convid:n,curuser:e.userid},l=[fetch("".concat(mn,"/messenger/conv/remover/").concat(e.userid),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"}),fetch("".concat(mn,"/messenger/conv/remover/").concat(r),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),credentials:"include"}),fetch("".concat(mn,"/messenger/convholder/remover"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userid:e.userid,convid:n}),credentials:"include"})];Promise.all(l).then((s=>{if(fetch("".concat(mn,"/messenger/lineup/order/").concat(e.userid),{credentials:"include"}).then((e=>e.json())).then((n=>{h(n.convs.lineup),b(!0),void 0!=n.convs.unread&&he(n.convs.unread),fetch("".concat(mn,"/messenger/lineup/checker/").concat(e.userid),{credentials:"include"}).then((e=>e.json())).then((n=>{for(let e=t.length-1;e>=0&&0==t[e].status;e--)fetch("".concat(mn,"/messenger/delete/").concat(t[e]._id),{method:"DELETE",credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}));Y(!0),S(null),c.map((n=>{n.sender===e.userid?n.effected.map((t=>{fetch("".concat(mn,"/messenger/decrementer/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:[e.userid,r],brand:n.brand,user:"curuser"}),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))})):n.receffected.map((t=>{fetch("".concat(mn,"/messenger/decrementer/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:[e.userid,r],brand:n.brand,user:"receiver"}),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))}))}))})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)})),Qe.current){let e=Ge.current._id;setTimeout((()=>{fetch("".concat(mn,"/messenger/convdel/reorder/").concat(r),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({converid:n}),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)})),Ze.current.emit("clientchangetextnums",{receiverid:r,convid:e,nevermessages:t})}),2200)}})).catch((e=>{console.log(e)}))}}()},pn=()=>{setTimeout((()=>{var e;null===(e=ze.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),200)};(0,r.useEffect)((()=>{setTimeout((()=>{Y(null)}),3e3)}),[K]),(0,r.useEffect)((()=>{setTimeout((()=>{ee(null)}),2500)}),[Q]),(0,r.useEffect)((()=>{fetch("".concat(mn,"/messenger/lineup/order/").concat(e.userid),{credentials:"include"}).then((e=>e.json())).then((e=>{void 0!=e.convs&&(h(e.convs.lineup),b(!0),he(e.convs.unread),an.current[0]=e.convs.lineup,an.current[1]=e.convs.unread)})).catch((e=>{console.log(e)}))}),[e.userid]),(0,r.useEffect)((()=>{nn.current=a,en.current=ue,setTimeout((()=>{fetch("".concat(mn,"/messenger/lineup/checker/").concat(e.userid),{credentials:"include"}).then((e=>e.json())).then((n=>{if(null==n){let n={username:e.usrn,userid:e.userid,lineup:nn.current,unread:{necessary:!1}};fetch("".concat(mn,"/messenger/lineup/create"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))}else{1==on.current&&(on.current=0,nn.current=an.current[0],en.current=an.current[1]);let t={};t=""==n.username?{username:e.usrn,lineup:nn.current,unread:en.current}:{lineup:nn.current,unread:en.current},fetch("".concat(mn,"/messenger/lineup/").concat(e.userid),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))}})).catch((e=>{console.log(e)}))}),1e3)}),[a,ue]);let vn=(0,c.Zp)();(0,r.useEffect)((()=>{fetch("".concat(mn,"/messenger"),{credentials:"include"}).then((e=>e.json())).then((e=>{"auth failed"!==e||vn("/",{replace:!0})})).catch((e=>{console.log(e)}))}),[]),(0,r.useEffect)((()=>{if(i(!1),T(""),Ge.current=_,null!=_){fetch("".concat(mn,"/messenger/ex/").concat(_._id),{credentials:"include"}).then((e=>e.json())).then((n=>{1!=_.holders.length||_.holders.includes(e.userid)||setTimeout((()=>{ee(!0)}),1500);let t=n.filter((n=>n.holders.includes(e.userid))),r=n.filter((e=>2==e.holders.length));if(w(t),0!=r.length)for(let l=r.length-1;l>=0;l--){var c,s;if(1==(null===(c=r[l])||void 0===c?void 0:c.status))break;if((null===(s=r[l])||void 0===s?void 0:s.sender)!==e.userid){var i;fetch("".concat(mn,"/messenger/seen/")+(null===(i=r[l])||void 0===i?void 0:i._id),{credentials:"include"}).then((e=>e.json())).then((e=>{Oe(!0)})).catch((e=>{console.log(e)}));const t=null===_||void 0===_?void 0:_.members.find((n=>n!==e.userid));Ze.current.emit("clientseen",{receiverid:t,status:!0,messagesREC:n,curchat:_})}}})).catch((e=>{console.log(e)}));let n=null;n=_.members[0]==e.userid?_.members[1]:_.members[0],fetch("".concat(mn,"/messenger/getconvostuff/").concat(n),{credentials:"include"}).then((e=>e.json())).then((e=>{e.identid=n,H(e),un.current=!0})).catch((e=>{console.log(e)}))}}),[_]),(0,r.useEffect)((()=>{un.current=!1}),[Me]),(0,r.useEffect)((()=>{var n,t;if($e.current&&($e.current=!1,setTimeout((()=>{var e;null===(e=ze.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),3e3)),fe(null===(n=y[y.length-1])||void 0===n?void 0:n._id),pe(null===(t=y[y.length-1])||void 0===t?void 0:t.sender),Xe.current=y,q){$(!1);let n=Object.keys(rn.current);if(0!=n.length){if(1==n.length)cn.current=Math.min(rn.current[n[0]][1],cn.current);else for(let e=0;e<n.length;e++)1==rn.current[n[e]][0]&&(cn.current=Math.min(rn.current[n[e]][1],cn.current));n.forEach((e=>{rn.current[e][0]&&(ln.current+=1)})),rn.current={}}if(U.last||Ne){let n;sn.current===ln.current-1?(cn.current=9999999999,sn.current=0,ln.current=0,Se(!1),Te(!1)):sn.current+=1,n=null==Ge.current?dn.current.members.find((n=>n!==e.userid)):Ge.current.members.find((n=>n!==e.userid)),fetch("".concat(mn,"/messenger/lineup/checker/").concat(n),{credentials:"include"}).then((e=>e.json())).then((t=>{let r={},c=[];c=null==Ge.current?t.lineup.filter((e=>e._id!=dn.current._id)):t.lineup.filter((e=>e._id!==Ge.current._id));let s=[];s=null==Ge.current?t.lineup.filter((e=>e._id==dn.current._id)):t.lineup.filter((e=>e._id==Ge.current._id));let i=[];if(void 0===y[y.length-1]){let e=[];for(let r=U.msg.order[n]+1;r<t.lineup.length;r++)U.msg.receffected.includes(t.lineup[r])||e.unshift(t.lineup[r]);c.splice(t.lineup.length,0,s[0]),U.status||(t.unread[Ge.current?Ge.current._id:dn.current._id]=!1),r={lineup:[...c],unread:t.unread},fetch("".concat(mn,"/messenger/lineup/").concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"include"}).then((e=>e.json())).then((e=>{Ze.current.emit("clientdelchange",{receiverid:n})})).catch((e=>{console.log(e)})),e.map((e=>{i.unshift(fetch("".concat(mn,"/messenger/decrementer/deltype").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userid:n}),credentials:"include"}))}))}else{let e=y[y.length-1].order[n];c.splice(e,0,s[0]),1==y[y.length-1].status&&(t.unread[Ge.current?Ge.current._id:dn.current._id]=!1),r={lineup:[...c],unread:t.unread},fetch("".concat(mn,"/messenger/lineup/").concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"include"}).then((e=>e.json())).then((e=>{Ze.current.emit("clientdelchange",{receiverid:n})})).catch((e=>{console.log(e)}))}U.msg.receffected.map((t=>{i.unshift(fetch("".concat(mn,"/messenger/decrementer/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:[n,e.userid],brand:U.msg.brand,user:"receiver"}),credentials:"include"}))})),Promise.all(i).then((e=>{Oe(!0)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)})),fetch("".concat(mn,"/messenger/lineup/checker/").concat(e.userid),{credentials:"include"}).then((e=>e.json())).then((t=>{let r,c={};r=null==Ge.current?t.lineup.filter((e=>e._id!=dn.current._id)):t.lineup.filter((e=>e._id!=Ge.current._id));let s=[];s=null==Ge.current?t.lineup.filter((e=>e._id==dn.current._id)):t.lineup.filter((e=>e._id==Ge.current._id));let i=[];if(void 0===y[y.length-1]){let n=[];for(let r=U.msg.order[e.userid]+1;r<t.lineup.length;r++)U.msg.effected.includes(t.lineup[r]._id)||n.unshift(t.lineup[r]);r.splice(t.lineup.length,0,s[0]),c={lineup:[...r],unread:t.unread},fetch("".concat(mn,"/messenger/lineup/").concat(e.userid),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c),credentials:"include"}).then((e=>e.json())).then((n=>{fetch("".concat(mn,"/messenger/lineup/order/").concat(e.userid),{credentials:"include"}).then((e=>e.json())).then((e=>{h(e.convs.lineup),b(!0),void 0!=e.convs.unread&&he(e.convs.unread)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)})),n.map((n=>{i.unshift(fetch("".concat(mn,"/messenger/decrementer/deltype").concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userid:e.userid}),credentials:"include"}))}))}else{let n=y[y.length-1].order[e.userid],s=[];s=null==Ge.current?t.lineup.filter((e=>e._id==dn.current._id)):t.lineup.filter((e=>e._id==Ge.current._id)),r.splice(n,0,s[0]),1==y[y.length-1].status&&(t.unread[Ge.current?Ge.current._id:dn.current._id]=!1),c={lineup:r,unread:t.unread},fetch("".concat(mn,"/messenger/lineup/").concat(e.userid),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c),credentials:"include"}).then((e=>e.json())).then((n=>{fetch("".concat(mn,"/messenger/lineup/order/").concat(e.userid),{credentials:"include"}).then((e=>e.json())).then((e=>{h(e.convs.lineup),b(!0),void 0!=e.convs.unread&&he(e.convs.unread)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}U.msg.effected.map((t=>{i.unshift(fetch("".concat(mn,"/messenger/decrementer/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:[e.userid,n],brand:U.msg.brand,user:"curuser"}),credentials:"include"}))})),Promise.all(i).then((e=>{Oe(!0)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}else{let n,t,r,c=y[cn.current];sn.current===ln.current-1?(cn.current=9999999999,sn.current=0,ln.current=0,Se(!1)):sn.current+=1,c.sender===e.userid?(n={own:[...c.brand.own,...U.msg.brand.own]},c.brand.entrusted&&U.msg.brand.entrusted?n.entrusted=[...c.brand.entrusted,...U.msg.brand.entrusted]:c.brand.entrusted?n.entrusted=[...c.brand.entrusted]:U.msg.brand.entrusted&&(n.entrusted=[...U.msg.brand.entrusted]),t=[...c.effected,...U.msg.effected],r=[...c.receffected,...U.msg.receffected]):(n={own:[...c.brand.own],entrusted:[...U.msg.brand.own]},U.msg.brand.entrusted&&n.own.push(...U.msg.brand.entrusted),c.brand.entrusted&&n.entrusted.push(...c.brand.entrusted),t=[...c.effected,...U.msg.receffected],r=[...c.receffected,...U.msg.effected]),(async()=>{const e=await fetch("".concat(mn,"/messenger/inheritance"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inheritorid:c._id,newbrand:n,neweffected:t,newreceffected:r}),credentials:"include"});await e.json();Oe(!0)})()}}for(let c=0;c<y.length;c++){var r;if(!Object.keys(F).includes(y[c]._id))if(0===c&&y[c].receiver===e.userid)V((e=>({...e,[y[c]._id]:!0})));else(null===(r=y[c-1])||void 0===r?void 0:r.sender)===e.userid&&V((e=>({...e,[y[c]._id]:!0})))}}),[y]),(0,r.useEffect)((()=>{Ze.current.on("servertypes",(e=>{var n,t,r;(null===(n=Be.current)||void 0===n?void 0:n.scrollHeight)-(null===(t=Be.current)||void 0===t?void 0:t.clientHeight)-((null===(r=Be.current)||void 0===r?void 0:r.scrollTop)+43)<=7&&setTimeout((()=>{var e;null===(e=ze.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),1e3)}))}),[]),(0,r.useEffect)((()=>{var e,n;(null===(e=Be.current)||void 0===e?void 0:e.scrollHeight)>(null===(n=Be.current)||void 0===n?void 0:n.clientHeight)&&B(!0)})),(0,r.useEffect)((()=>{we(!0),rn.current={},Te(!1),ce(!1),setTimeout((()=>{var e;null===(e=ze.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),3300)}),[_]),(0,r.useEffect)((()=>{Ze.current.emit("addMe",e.userid),Ze.current.on("onlinefrens",(n=>{let t=e.following;t.filter((e=>n.some((n=>n.userid===e))));E(t.filter((e=>n.some((n=>n.userid===e))))),Ue.current=n;let r=window.location.pathname.replace("/messenger/",""),c=r.replace("outsider/","").replace("insider/","");"o"==r[0]&&Je({verdict:!0,data:c})}))}),[e]),(0,r.useEffect)((()=>{tn.current=le,Object.keys(tn.current).length==Xe.current.length&&(dn.current=Ge.current)}),[le]);const jn=e=>{hn((0,v.gl)(e)),vn("/profile/".concat(e))};return(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("div",{className:n?"messenger ":"messengernight",children:[(0,d.jsx)("div",{className:"menu ",children:(0,d.jsxs)("div",{className:"menuwrap",children:[(0,d.jsx)("input",{placeholder:"search conversations...",className:n?"searchmessages":"searchmessagesnight",onChange:n=>{""===n.target.value?X(null):fetch("".concat(mn,"/messenger/lineup/order/").concat(e.userid),{credentials:"include"}).then((e=>e.json())).then((e=>{Ke.current=e.convs.lineup,We.current=e.searchhelper;let t=We.current.map((e=>{const t=new RegExp("^".concat(n.target.value));if(t.test(e[0])||t.test(e[1]))for(let n=0;n<Ke.current.length;n++)if(Ke.current[n].members.includes(e[2]))return Ke.current[n]}));X(t.filter((e=>void 0!=e)))})).catch((e=>{console.log(e)}))}}),null==G?a.map((e=>(0,d.jsx)("div",{onClick:()=>{fn(e)},children:(0,d.jsx)(o,{conver:e,latestchat:ue,setFromconv:Ee,fromconv:ke})},e._id))):G.map((e=>(0,d.jsx)("div",{onClick:()=>{fn(e)},children:(0,d.jsx)(o,{conver:e,latestchat:ue,setFromconv:Ee,fromconv:ke})},e._id)))]})}),(0,d.jsx)("div",{className:n?"area":"areanight",children:(0,d.jsx)("div",{className:"areawrap",children:x?0!=a.length||null!=_?(0,d.jsx)(d.Fragment,{children:_?(0,d.jsx)(d.Fragment,{children:K?(0,d.jsx)(d.Fragment,{children:(0,d.jsx)("div",{className:"loadingscreen"})}):(0,d.jsx)(d.Fragment,{children:Q?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:n?"w-6 h-6 chatcloud":"w-6 h-6 chatcloudnight",children:(0,d.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z"})}),(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:n?"w-6 h-6 chatuser":"w-6 h-6 chatusernight",children:(0,d.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})}),(0,d.jsx)("span",{className:n?"selectconvo":"selectconvonight",children:" this chat had been deleted by you  "})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:n?"identitybar":"identitybarnight",children:[un.current?(0,d.jsx)("img",{className:"identityimg",alt:" ",src:null!=A?A.pfp:" ",onClick:()=>{jn(A.username)}}):(0,d.jsx)("div",{className:"identityimgskeleton",children:(0,d.jsx)(l.A,{})}),un.current?(0,d.jsx)("span",{className:n?"identityname":"identitynamenight",onClick:()=>{jn(A.username)},children:null!=A?A.fname:""}):(0,d.jsx)("div",{className:"identityfnameskeleton",children:(0,d.jsx)(l.A,{})}),un.current?(0,d.jsx)("span",{className:n?"identityusrname":"identityusrnamenight",onClick:()=>{jn(A.username)},children:null!=A?"@".concat(A.username):""}):(0,d.jsx)("div",{className:"identityusernameskeleton",children:(0,d.jsx)(l.A,{})}),k.includes(null===A||void 0===A?void 0:A.identid)&&(0,d.jsx)("div",{className:"mark"}),xe?(0,d.jsxs)("div",{className:"upperoptions",children:[(0,d.jsx)("div",{children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"27",height:"27",fill:"currentColor",className:n?"bi bi-arrow-return-left notdelsel":"bi bi-arrow-return-left notdelsel topiconnight",onClick:()=>{Se(!1),rn.current={},we(!0),Te(!1)},viewBox:"0 0 16 16",children:(0,d.jsx)("path",{"fill-rule":"evenodd",d:"M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5z"})})}),(0,d.jsx)("div",{children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"27",height:"27",fill:"currentColor",className:n?"bi bi-trash2-fill seldel":"bi bi-trash2-fill seldel topiconnight",onClick:()=>{dn.current?gn(dn.current._id):Se(!0),we(!0)},viewBox:"0 0 16 16",children:(0,d.jsx)("path",{d:"M2.037 3.225A.703.703 0 0 1 2 3c0-1.105 2.686-2 6-2s6 .895 6 2a.702.702 0 0 1-.037.225l-1.684 10.104A2 2 0 0 1 10.305 15H5.694a2 2 0 0 1-1.973-1.671L2.037 3.225zm9.89-.69C10.966 2.214 9.578 2 8 2c-1.58 0-2.968.215-3.926.534-.477.16-.795.327-.975.466.18.14.498.307.975.466C5.032 3.786 6.42 4 8 4s2.967-.215 3.926-.534c.477-.16.795-.327.975-.466-.18-.14-.498-.307-.975-.466z"})})})]}):(0,d.jsx)("div",{children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",fill:"currentColor",className:n?"bi bi-trash3 topdelete":"bi bi-trash3 topdelete topiconnight",onClick:()=>{gn(_._id)},viewBox:"0 0 16 16",children:(0,d.jsx)("path",{d:"M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"})})})]}),(0,d.jsxs)("div",{ref:Be,className:"areawrapupper",children:[y.map((n=>(0,d.jsx)("div",{ref:C?He:Ae,className:F[n._id]?"":"pdleft",children:(0,d.jsx)(u,{onechat:n,own:n.sender===e.userid,ident:A,status:n.status,id:n._id,rec:me,pfpobj:F,finalseen:z,messages:y,setMessages:w,Currentchat:_,socket:Ze,setShddel:$,setTextdets:W,redisplaylane:se,setRedisplaylane:ie,redselector:le,setRedselector:de,setNodel:be,goback:ye,setGoback:we,groupdeletion:_e,groupie:tn.current[n._id],safeinherit:rn,setMultiplelast:Te,sempahore:un.current})},n._id))),(0,d.jsx)("div",{ref:Le,children:ge===e.userid?(0,d.jsx)(d.Fragment,{children:(null===L||void 0===L?void 0:L.includes(_._id))&&(0,d.jsxs)("div",{className:"typerimgdiv",children:[(0,d.jsx)("img",{className:"typerimg",alt:" ",src:null!=A?A.pfp:" "}),(0,d.jsx)("div",{className:"typestatus",style:{padding:"10px",marginTop:"4px",borderRadius:"20px",backgroundColor:"rgb(30,36,36)",color:"white",maxWidth:"60px"},children:(0,d.jsxs)("div",{className:"threedots",children:[(0,d.jsx)("div",{className:"adot",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"8",width:"8",fill:"currentColor",class:"bi bi-circle-fill",viewBox:"0 0 16 16",children:(0,d.jsx)("circle",{cx:"8",cy:"8",r:"8"})})}),(0,d.jsx)("div",{className:"adot",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"8",width:"8",fill:"currentColor",class:"bi bi-circle-fill",viewBox:"0 0 16 16",children:(0,d.jsx)("circle",{cx:"8",cy:"8",r:"8"})})}),(0,d.jsx)("div",{className:"adot",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"8",width:"8",fill:"currentColor",class:"bi bi-circle-fill",viewBox:"0 0 16 16",children:(0,d.jsx)("circle",{cx:"8",cy:"8",r:"8"})})})]})})]})}):(0,d.jsx)(d.Fragment,{children:(null===L||void 0===L?void 0:L.includes(_._id))&&(0,d.jsx)("div",{className:"typestatus",style:{padding:"10px",marginLeft:"50px",marginTop:"11px",borderRadius:"20px",backgroundColor:"rgb(30,36,36)",color:"white",maxWidth:"60px"},children:(0,d.jsxs)("div",{className:"threedots",children:[(0,d.jsx)("div",{className:"adot",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"8",width:"8",fill:"currentColor",class:"bi bi-circle-fill",viewBox:"0 0 16 16",children:(0,d.jsx)("circle",{cx:"8",cy:"8",r:"8"})})}),(0,d.jsx)("div",{className:"adot",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"8",width:"8",fill:"currentColor",class:"bi bi-circle-fill",viewBox:"0 0 16 16",children:(0,d.jsx)("circle",{cx:"8",cy:"8",r:"8"})})}),(0,d.jsx)("div",{className:"adot",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"8",width:"8",fill:"currentColor",class:"bi bi-circle-fill",viewBox:"0 0 16 16",children:(0,d.jsx)("circle",{cx:"8",cy:"8",r:"8"})})})]})})})}),(0,d.jsx)("div",{ref:ze,style:{padding:"10px"}}),ne&&I&&(0,d.jsx)("div",{className:"fastscrollnew",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",fill:"currentColor",className:"bi bi-chat-fill",onClick:pn,viewBox:"0 0 16 16",children:(0,d.jsx)("path",{d:"M8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6-.097 1.016-.417 2.13-.771 2.966-.079.186.074.394.273.362 2.256-.37 3.597-.938 4.18-1.234A9.06 9.06 0 0 0 8 15z"})})}),re&&(0,d.jsx)("div",{className:"fastscroll",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",fill:"currentColor",className:"bi bi-arrow-down-circle-fill",onClick:pn,viewBox:"0 0 16 16",children:(0,d.jsx)("path",{d:"M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V4.5z"})})})]}),(0,d.jsxs)("div",{className:"areawraplower",children:[(0,d.jsx)("textarea",{className:n?"chatfield":"chatfieldnight",placeholder:"send message...",onChange:n=>{var t,r;const c=_.members.find((n=>n!==e.userid));Fe.current=(null===(t=Be.current)||void 0===t?void 0:t.scrollHeight)-(null===(r=Be.current)||void 0===r?void 0:r.clientHeight),Ze.current.emit("clienttypes",{dims:Fe.current,status:!0,receiverid:c,curchat:_}),/[^\s]/.test(n.target.value)?i(!0):i(!1),T(n.target.value)},value:N}),(0,d.jsx)("button",{className:t?"chatsender":"chatsender blocked",onClick:n=>{var t,r,c;let s;$e.current=!0,n.preventDefault(),i(!1),s=(null===(t=nn.current[0])||void 0===t?void 0:t._id)===Ge.current._id;const l=_.members.find((n=>n!==e.userid));let d,o=nn.current.length;var u;void 0===Xe.current[Xe.current.length-1]?d=nn.current.length:d=null===(u=Xe.current[Xe.current.length-1])||void 0===u?void 0:u.order[e.userid];let m;void 0!=Xe.current[Xe.current.length-1]&&(m=Xe.current[Xe.current.length-1].order[l]),De.current=(null===(r=Be.current)||void 0===r?void 0:r.scrollHeight)-(null===(c=Be.current)||void 0===c?void 0:c.clientHeight),1==Ge.current.holders.length&&(Ge.current.holders.includes(e.userid)?fetch("".concat(mn,"/messenger/lineupholder/").concat(e.userid),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({members:Ge.current.members,curchat:Ge.current._id}),credentials:"include"}).then((e=>e.json())).then((n=>{setTimeout((()=>{h((t=>{b(!0);let r=n.lineup,c=r.filter((e=>e._id===Ge.current._id)),s=r.filter((e=>e._id!==Ge.current._id));if(0==c.length){let n={_id:Ge.current._id,members:[e.userid,l],holders:[e.userid,l]};return s.unshift(n),[...s]}return s.unshift(c[0]),[...s]}))}),3e3)})).catch((e=>{console.log(e)})):Ze.current.emit("clientaddholder",{receiverid:l,curchat:Ge.current._id,members:Ge.current.members})),h((n=>{b(!0);let t=nn.current,r=t.filter((e=>e._id===Ge.current._id)),c=t.filter((e=>e._id!==Ge.current._id));if(0==r.length){let n={_id:Ge.current._id,members:[e.userid,l],holders:[e.userid,l]};return c.unshift(n),[...c]}return c.unshift(r[0]),[...c]})),async function(){const n=await fetch("".concat(mn,"/messenger/alreadyconv/checker"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([e.userid,l]),credentials:"include"}),t=await n.json();if(fetch("".concat(mn,"/messenger/holderedit/").concat(e.userid),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({members:Ge.current.members,curchat:Ge.current._id}),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)})),null===t){let n=(0,g.A)();if(!s)for(let s=0;s<=o;s++){var r;(null===(r=nn.current[s])||void 0===r?void 0:r._id)!==Ge.current._id&&fetch("".concat(mn,"/messenger/incrementer/").concat(nn.current[s]._id),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.userid,brand:n,new:!0,user:"curuser",comparerval:null}),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))}let t=null;t=ve.members[0]==e.userid?ve.members[1]:ve.members[0];let c={senderId:e.userid,receiverId:t};fetch("".concat(mn,"/messenger/create"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c),credentials:"include"}).then((e=>e.json())).then((t=>{let r=t;S(t),h([t,...a]),b(!0),je(null);const c=t.members.find((n=>n!==e.userid));let s,i={[e.userid]:0,[c]:0},l=nn.current.map((e=>{if(e._id!=Ge.current._id)return e._id})).filter((e=>null!=e));fetch("".concat(mn,"/messenger/lineup/checker/").concat(c),{credentials:"include"}).then((e=>e.json())).then((t=>{if(null==t){if(s=[],!Ue.current.includes(c)){let t={username:"",userid:c,lineup:[Ge.current],unread:{[Ge.current._id]:!0,necessary:!1}};fetch("".concat(mn,"/messenger/lineup/create"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"}).then((e=>e.json())).then((t=>{const d={conversationId:r._id,sender:e.userid,receiver:c,thetext:N,status:!1,order:i,holders:[e.userid,c],brand:{own:[n]},branding:[],effected:l,recbranding:[],receffected:s};fetch("".concat(mn,"/messenger/send"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),credentials:"include"}).then((e=>e.json())).then((n=>{Ze.current.emit("textclient",{senderid:e.userid,receiverid:c,recenttext:N,converid:r._id,saveID:n._id,curchat:Ge.current,status:!1,order:i,holders:[e.userid,c],brand:n.brand.own[0],branding:n.branding,effected:n.effected,recbranding:n.recbranding,receffected:n.receffected,newlatestchat:t.unread,newconversationlineup:t.lineup}),w([...y,n]),R([...M,!0]),T(""),O(!1)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}}else if(0==t.lineup.length){if(s=[],!Ue.current.includes(c)){let t={lineup:[Ge.current],unread:{[Ge.current._id]:!0,necessary:!1}};fetch("".concat(mn,"/messenger/lineup/").concat(c),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"}).then((e=>e.json())).then((t=>{const d={conversationId:r._id,sender:e.userid,receiver:c,thetext:N,status:!1,order:i,holders:[e.userid,c],brand:{own:[n]},branding:[],effected:l,recbranding:[],receffected:s};fetch("".concat(mn,"/messenger/send"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),credentials:"include"}).then((e=>e.json())).then((n=>{Ze.current.emit("textclient",{senderid:e.userid,receiverid:c,recenttext:N,converid:r._id,saveID:n._id,curchat:Ge.current,status:!1,order:i,holders:[e.userid,c],brand:n.brand.own[0],branding:n.branding,effected:n.effected,recbranding:n.recbranding,receffected:n.receffected,newlatestchat:t.unread,newconversationlineup:t.lineup}),w([...y,n]),R([...M,!0]),T(""),O(!1)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}}else{let d=t.lineup.map((e=>e._id));if(s=d.filter((e=>null!=e)),!Ue.current.includes(c)){let d={},o=t.lineup.filter((e=>e._id!=Ge.current._id));void 0!=t.unread?Object.keys(t.unread).includes(Ge.current._id)?(t.unread[Ge.current._id]=!0,d={lineup:[Ge.current,...o],unread:t.unread}):d={lineup:[Ge.current,...o],unread:{...t.unread,[Ge.current._id]:!0}}:d={lineup:[Ge.current,...o],unread:{[Ge.current._id]:!0}},fetch("".concat(mn,"/messenger/lineup/").concat(c),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),credentials:"include"}).then((e=>e.json())).then((d=>{for(let e=0;e<t.lineup.length;e++)t.lineup[e]._id!=Ge.current._id&&fetch("".concat(mn,"/messenger/incrementer/").concat(t.lineup[e]._id),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:c,brand:n,new:!0,user:"receiver",comparerval:null}),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}));const o={conversationId:r._id,sender:e.userid,receiver:c,thetext:N,status:!1,order:i,holders:[e.userid,c],brand:{own:[n]},branding:[],effected:l,recbranding:[],receffected:s};fetch("".concat(mn,"/messenger/send"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),credentials:"include"}).then((e=>e.json())).then((n=>{Ze.current.emit("textclient",{senderid:e.userid,receiverid:c,recenttext:N,converid:r._id,saveID:n._id,curchat:Ge.current,status:!1,order:i,holders:[e.userid,c],brand:n.brand.own[0],branding:n.branding,effected:n.effected,recbranding:n.recbranding,receffected:n.receffected,newlatestchat:t.unread,newconversationlineup:t.lineup}),w([...y,n]),R([...M,!0]),T(""),O(!1)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}}})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}else if(2==t.holders.length){let n=(0,g.A)();if(!s)for(let s=0;s<=d;s++)s<nn.current.length&&nn.current[s]._id!==Ge.current._id&&void 0!=nn.current[s]&&fetch("".concat(mn,"/messenger/incrementer/").concat(nn.current[s]._id),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.userid,brand:n,new:!1,user:"curuser",comparerval:d}),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}));const t=_.members.find((n=>n!==e.userid));let r={[e.userid]:0,[t]:0},c=[];for(let e=0;e<=d;e++)void 0!=nn.current[e]&&nn.current[e]._id!==Ge.current._id&&c.unshift(nn.current[e]._id);let i=[];fetch("".concat(mn,"/messenger/lineup/checker/").concat(t),{credentials:"include"}).then((e=>e.json())).then((s=>{void 0===Xe.current[Xe.current.length-1]&&(m=s.lineup.length);for(let e=0;e<=m;e++)void 0!=s.lineup[e]&&s.lineup[e]._id!==Ge.current._id&&i.unshift(s.lineup[e]._id);if(!Ue.current.includes(t)){s.lineup[0]._id===Ge.current._id?Ye.current=!0:Ye.current=!1;let l={},d=s.lineup.filter((e=>e._id!=Ge.current._id));void 0!=s.unread?Object.keys(s.unread).includes(Ge.current._id)?(s.unread[Ge.current._id]=!0,l={lineup:[Ge.current,...d],unread:s.unread}):l={lineup:[Ge.current,...d],unread:{...s.unread,[Ge.current._id]:!0}}:l={lineup:[Ge.current,...d],unread:{[Ge.current._id]:!0}},fetch("".concat(mn,"/messenger/lineup/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l),credentials:"include"}).then((e=>e.json())).then((l=>{Ye.current||async function(){let e;const r=await fetch("".concat(mn,"/messenger/findmytextsifany/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({convid:Ge.current._id}),credentials:"include"}),c=await r.json();e=void 0===c[c.length-1]?s.lineup.length:c[c.length-1].order[t];for(let i=0;i<=e;i++)void 0!=s.lineup[i]&&s.lineup[i]._id!=Ge.current._id&&fetch("".concat(mn,"/messenger/incrementer/").concat(s.lineup[i]._id),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t,brand:n,new:!1,user:"receiver",comparerval:e}),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))}();const d={conversationId:_._id,sender:e.userid,receiver:t,thetext:N,status:!1,order:r,holders:[e.userid,t],brand:{own:[n]},branding:[],effected:c,recbranding:[],receffected:i};fetch("".concat(mn,"/messenger/send"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),credentials:"include"}).then((e=>e.json())).then((n=>{Ze.current.emit("textclient",{senderid:e.userid,receiverid:t,recenttext:N,converid:_._id,saveID:n._id,status:!1,curchat:Ge.current,order:r,holders:[e.userid,t],brand:n.brand.own[0],branding:n.branding,effected:n.effected,recbranding:n.recbranding,receffected:n.receffected,newlatestchat:s.unread,newconversationlineup:s.lineup}),w([...y,n]),R([...M,!0]),T(""),O(!1)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}})).catch((e=>{console.log(e)}))}else{let n=(0,g.A)();if(!s){let r={id:e.userid,brand:n,new:!t.holders.includes(e.userid),user:"curuser",comparerval:t.holders.includes(e.userid)?d:null};for(let n=0;(n<=t.holders.includes(e.userid)?d:o)&&!(n>=nn.current.length);n++)nn.current[n]._id!==Ge.current._id&&void 0!=nn.current[n]&&fetch("".concat(mn,"/messenger/incrementer/").concat(nn.current[n]._id),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))}const r=_.members.find((n=>n!==e.userid));let i={[e.userid]:0,[r]:0},l=[];if(t.holders.includes(e.userid))for(let e=0;e<=d;e++){var c;(null===(c=nn.current[e])||void 0===c?void 0:c._id)!==Ge.current._id&&void 0!=nn.current[e]&&l.unshift(nn.current[e]._id)}else{let e=nn.current.map((e=>{if(e._id!=Ge.current._id)return e._id}));l=e.filter((e=>null!=e))}let a=[];fetch("".concat(mn,"/messenger/lineup/checker/").concat(r),{credentials:"include"}).then((e=>e.json())).then((c=>{if(0==c.lineup.length){if(a=[],!Ue.current.includes(r)){let t={lineup:[Ge.current],unread:{[Ge.current._id]:!0,necessary:!1}};fetch("".concat(mn,"/messenger/lineup/").concat(r),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"}).then((e=>e.json())).then((t=>{const c={conversationId:_._id,sender:e.userid,receiver:r,thetext:N,status:!1,order:i,holders:[e.userid,r],brand:{own:[n]},branding:[],effected:l,recbranding:[],receffected:a};fetch("".concat(mn,"/messenger/send"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c),credentials:"include"}).then((e=>e.json())).then((n=>{Ze.current.emit("textclient",{senderid:e.userid,receiverid:r,recenttext:N,converid:_._id,saveID:n._id,status:!1,curchat:Ge.current,order:i,holders:[e.userid,r],brand:n.brand.own[0],branding:n.branding,effected:n.effected,recbranding:n.recbranding,receffected:n.receffected,newlatestchat:t.unread,newconversationlineup:t.lineup}),w([...y,n]),R([...M,!0]),T(""),O(!1)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}}else{if(t.holders.includes(r))for(let e=0;e<=m;e++){var s;(null===(s=c.lineup[e])||void 0===s?void 0:s._id)!==Ge.current._id&&a.unshift(c.lineup[e]._id)}else{let e=c.lineup.map((e=>{if(e._id!=Ge.current._id)return e._id}));a=e.filter((e=>null!=e))}if(!Ue.current.includes(r)){c.lineup[0]._id===Ge.current._id?Ye.current=!0:Ye.current=!1;let s={},d=c.lineup.filter((e=>e._id!=Ge.current._id));void 0!=c.unread?Object.keys(c.unread).includes(Ge.current._id)?(c.unread[Ge.current._id]=!0,s={lineup:[Ge.current,...d],unread:c.unread}):s={lineup:[Ge.current,...d],unread:{...c.unread,[Ge.current._id]:!0}}:s={lineup:[Ge.current,...d],unread:{[Ge.current._id]:!0}},fetch("".concat(mn,"/messenger/lineup/").concat(r),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"}).then((e=>e.json())).then((s=>{if(t.holders.includes(r)){async function o(){let e;const t=await fetch("".concat(mn,"/messenger/findmytextsifany/").concat(r),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({convid:Ge.current._id}),credentials:"include"}),s=await t.json();e=s[s.length-1].order[r];for(let i=0;i<=e;i++)c.lineup[i]._id!=Ge.current._id&&fetch("".concat(mn,"/messenger/incrementer/").concat(c.lineup[i]._id),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r,brand:n,new:!1,user:"receiver",comparerval:e}),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))}Ye.current||o()}else for(let u=0;u<=c.lineup.length;u++)void 0!=c.lineup[u]&&c.lineup[u]._id!=Ge.current._id&&fetch("".concat(mn,"/messenger/incrementer/").concat(c.lineup[u]._id),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r,brand:n,new:!0,user:"receiver",comparerval:null}),credentials:"include"}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}));const d={conversationId:_._id,sender:e.userid,receiver:r,thetext:N,status:!1,order:i,holders:[e.userid,r],brand:{own:[n]},branding:[],effected:l,recbranding:[],receffected:a};fetch("".concat(mn,"/messenger/send"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),credentials:"include"}).then((e=>e.json())).then((n=>{Ze.current.emit("textclient",{senderid:e.userid,receiverid:r,recenttext:N,converid:_._id,saveID:n._id,status:!1,curchat:Ge.current,order:i,holders:[e.userid,r],brand:n.brand.own[0],branding:n.branding,effected:n.effected,recbranding:n.recbranding,receffected:n.receffected,newlatestchat:c.unread,newconversationlineup:c.lineup}),w([...y,n]),R([...M,!0]),T(""),O(!1)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}}})).catch((e=>{console.log(e)}))}}()},children:"send"})]})]})})}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:n?"w-6 h-6 chatcloud":"w-6 h-6 chatcloudnight",children:(0,d.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z"})}),(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:n?"w-6 h-6 chatuser":"w-6 h-6 chatusernight",children:(0,d.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})}),(0,d.jsx)("span",{className:n?"selectconvo":"selectconvonight",children:"select a conversation to begin chatting !"})]})}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:n?"w-6 h-6 chatcloud":"w-6 h-6 chatcloudnight",children:(0,d.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z"})}),(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:n?"w-6 h-6 chatuser":"w-6 h-6 chatusernight",children:(0,d.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})}),(0,d.jsx)("span",{className:n?"selectconvohuge":"selectconvohugenight",children:"follow someone to start chatting or have a look at recommendations !"})]}):(0,d.jsx)(d.Fragment,{children:(0,d.jsx)("div",{className:"loadingscreen"})})})}),(0,d.jsx)("div",{className:"currentonline ",children:(0,d.jsx)("div",{className:"curonlinewrap",children:(0,d.jsx)(m,{onl:k,setCurrentchat:S,Currentchat:_,setDraft:je,draft:ve,outsider:Pe,setOutsider:Je,semaphore:un.current,setOnlchatclicked:Re,onlchatclicked:Me})})}),(0,d.jsx)("div",{className:n?"homediv":"homedivnight",onClick:()=>{vn("/welcome"),hn((0,j.PJ)("HomeIcon"))},children:(0,d.jsx)(p.A,{className:n?"texthomeicon":"texthomeiconnight"})}),(0,d.jsx)("div",{className:n?"lowerblack":"lowerblacknight"})]})})}},3837:(e,n,t)=>{t.d(n,{A:()=>i});var r=t(9998),c=t(6914),s=t(6723);const i=e=>{let{trigger:n}=e;return r.createPortal((0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"blurremainload"}),(0,s.jsx)("div",{className:"loadring",children:(0,s.jsx)(c.A,{size:40,lineWeight:5,speed:2,color:"white"})})]}),document.getElementById("portal"))}},4202:(e,n,t)=>{t.d(n,{A:()=>_});var r=t(9998),c=t(3837),s=t(2483),i=t(7757),l=t(4511),d=t(3376),o=t(831),a=t(8840),u=t(6585),h=t(3057),m=t(4316),f=t(9313),g=t(8025),p=t(5035),v=t(8607),j=t(8487),x=t(5197),b=t(5846),y=t(1003),w=t(6723);const _=e=>{let{trigger:n,text:t,bold:_,extra:S}=e,[N,T]=(0,s.useState)(!1),C=(0,i.d4)((e=>e.themeyr.value)),O=(0,d.Zp)();const k=(0,i.wA)();let E="http://localhost:3001";return r.createPortal((0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{className:"blurremainy"}),N&&(0,w.jsx)(c.A,{}),!N&&(0,w.jsxs)("div",{className:C?"yesnomodal":"yesnomodal yesnomodalnight",children:["newconv"==S.purpose?(0,w.jsxs)("span",{className:C?"thetextnewconv":"thetextnewconv nighttextyesno",children:[t," ",(0,w.jsx)("b",{children:_})," ?"]}):"delpost"==S.purpose?(0,w.jsxs)("span",{className:C?"thetextdel":"thetextdel nighttextyesno ",children:[(0,w.jsx)("b",{children:_})," ",t," ?"]}):"logger"==S.purpose?(0,w.jsxs)("span",{className:C?"thetextlogout":"thetextlogout nighttextyesno ",children:[t," ",(0,w.jsx)("b",{children:_})," ?"]}):(0,w.jsxs)("span",{className:C?"thetext":"thetext nighttextyesno ",children:[t," ",(0,w.jsx)("b",{children:_})," ?"]}),(0,w.jsx)("div",{className:C?"nobutdiv":"nobutdiv nobutdivnight",onClick:()=>{"logger"==S.purpose&&S.setCursel(null),"newconv"!=S.purpose?n(!1):n({})},children:(0,w.jsx)("button",{className:C?"nobut":"nobut nighttextyesno",children:"NO"})}),(0,w.jsx)("div",{className:C?"yesbutdiv":"yesbutdiv yesbutdivnight",onClick:()=>{if("newconv"==S.purpose&&(S.startconvhandler(S.main),S.setOnlchatclicked(!S.skeletonidentity),n({})),"cancelreq"==S.purpose){fetch("".concat(E,"/users/followcancel/").concat(S.viewperson),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:S.curuser.usrn}),credentials:"include"}),S.setAsktofollow(!1),n(!1);const e={username:S.curuser.usrn,type:"followreqdel"};fetch("".concat(E,"/notif/rem/").concat(S.viewperson),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"})}if("delpost"==S.purpose){let e={username:S.curuser.usrn};fetch("".concat(E,"/posts/delete/").concat(S.thepost._id),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"}),fetch("".concat(E,"/notif/postdel/").concat(S.thepost._id),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"user"}),credentials:"include"}),T(!0),setTimeout((()=>{T(!1),n(!1),S.setDelsuccess(!0)}),3e3)}"logger"==S.purpose&&(T(!0),setTimeout((()=>{T(!1),n(!1),fetch("".concat(E,"/logout"),{credentials:"include"}),k((0,l.$M)(!1)),O("/",{replace:!0})}),3e3),setTimeout((()=>{k((0,o.Xj)(!0)),k((0,a.dR)(!0)),k((0,u.A4)(!0)),k((0,h.jT)(!0)),k((0,l.NG)(!0)),k((0,m.kE)(!0)),k((0,f.$N)(!0)),k((0,g.oj)(!0)),k((0,p.dM)(!0)),k((0,v.FP)(!0)),k((0,j.iE)(!0)),k((0,x.NN)(!0)),k((0,b.GJ)(!0)),k((0,y.tj)(!0))}),5e3))},children:(0,w.jsx)("button",{className:C?"yesbut":"yesbut nighttextyesno",children:"YES"})})]})]}),document.getElementById("portal"))}},6854:(e,n,t)=>{t.d(n,{A:()=>c});t(6377),t(2483);var r=t(6723);const c=()=>(0,r.jsx)("div",{className:"shimmer-wrap",children:(0,r.jsx)("div",{className:"shimmer"})})}}]);
//# sourceMappingURL=861.2717b632.chunk.js.map